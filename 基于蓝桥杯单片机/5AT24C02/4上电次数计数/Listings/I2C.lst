C51 COMPILER V9.60.0.0   I2C                                                               03/18/2023 17:41:31 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN ..\Output\I2C.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE ..\Source\I2C.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(..\Lis
                    -tings\I2C.lst) OBJECT(..\Output\I2C.obj)

line level    source

   1          #include "I2C.h"
   2          
   3          void I2CStart()
   4          {
   5   1              I2C_SDA = 1;//总线空闲时SCL和SDA都为高电平
   6   1              I2C_SCL = 1;
   7   1              I2CDelay();//SCL保持4.7us后拉低，SDA产生起始信号
   8   1              I2C_SDA = 0;
   9   1              I2CDelay();
  10   1              I2C_SCL = 0;
  11   1      }
  12          
  13          bit I2CWriteByte(unsigned char dat)
  14          {
  15   1              bit ack;
  16   1              unsigned char tmp;
  17   1              for(tmp = 0x80;tmp != 0;tmp >>= 1)
  18   1              {
  19   2                      if((tmp&dat)==0)
  20   2                              I2C_SDA = 0;
  21   2                      else
  22   2                              I2C_SDA = 1;
  23   2                      I2CDelay();
  24   2                      I2C_SCL = 1;
  25   2                      I2CDelay();
  26   2                      I2C_SCL = 0;
  27   2              }
  28   1              ack = I2CRecAck();
  29   1              return ack;
  30   1      }
  31          unsigned char I2CReadByte()
  32          {
  33   1              unsigned char tmp;
  34   1              unsigned char dat=0;
  35   1              I2C_SDA = 1;
  36   1              for(tmp = 0x80;tmp != 0;tmp >>= 1)
  37   1              {
  38   2                      I2CDelay();
  39   2                      I2C_SCL = 1;
  40   2                      if(I2C_SDA == 1)
  41   2                              dat |= tmp;
  42   2                      else 
  43   2                              dat &= ~tmp;
  44   2                      I2CDelay();
  45   2                      I2C_SCL = 0;
  46   2              }
  47   1              return dat;
  48   1      }
  49          
  50          bit I2CRecAck()
  51          {
  52   1              bit ack;
  53   1              I2C_SDA = 1;
  54   1              I2CDelay();
C51 COMPILER V9.60.0.0   I2C                                                               03/18/2023 17:41:31 PAGE 2   

  55   1              I2C_SCL = 1;
  56   1              I2CDelay();
  57   1              ack = I2C_SDA;
  58   1              I2CDelay();
  59   1              I2C_SCL = 0;
  60   1              return ack;
  61   1      }
  62          
  63          void SendAck(bit ack)
  64          {
  65   1              I2C_SDA = ack;
  66   1              I2CDelay();
  67   1              I2C_SCL = 1;
  68   1              I2CDelay();
  69   1              I2C_SCL = 0;
  70   1      }
  71          void I2CStop()
  72          {
  73   1              I2C_SDA = 0;//总线SCL和SDA都为低电平
  74   1              I2C_SCL = 0;
  75   1              I2CDelay();
  76   1              I2C_SCL = 1;
  77   1              I2CDelay();
  78   1              I2C_SDA = 1;
  79   1              I2CDelay();
  80   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       3
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
