C51 COMPILER V9.60.0.0   MAIN                                                              02/14/2023 00:09:59 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN ..\Output\main.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE ..\Source\main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(..\Li
                    -stings\main.lst) OBJECT(..\Output\main.obj)

line level    source

   1          #include <reg51.h>
   2          #include "display.h"
   3          
   4          void Timer1Init(void);
   5          void Timer0Init(void);
   6          void ShowNormal();
   7          void ShowSec();
   8          void ShowMin();
   9          void ShowHou();
  10          void EX0_Init(void);
  11          void EX1_Init(void);
  12          
  13          unsigned char TimerCnt;
  14          unsigned char Sec;
  15          unsigned char Min;
  16          unsigned char Hou;
  17          unsigned char state;
  18          
  19          void main()
  20          {
  21   1              Timer1Init();
  22   1              Timer0Init();
  23   1              EX0_Init();
  24   1              EX1_Init();
  25   1              EA = 1;
  26   1              while(1)
  27   1              {
  28   2                      switch(state)
  29   2                      {
  30   3                              case 0:ShowNormal();break;
  31   3                              case 1:ShowSec();break;
  32   3                              case 2:ShowMin();break;
  33   3                              case 3:ShowHou();break;
  34   3                              default:break;
  35   3                      }
  36   2              }
  37   1      }
  38          
  39          void Timer0Init(void)           //50毫秒@11.0592MHz
  40          {
  41   1      
  42   1              TMOD &= 0xF0;           //设置定时器模式
  43   1              TMOD |= 0x01;           //设置定时器模式
  44   1              TL0 = 0x00;             //设置定时初始值
  45   1              TH0 = 0x4C;             //设置定时初始值
  46   1              TF0 = 0;                //清除TF0标志
  47   1              ET0 = 1;
  48   1              TR0 = 1;                //定时器0开始计时
  49   1      }
  50          
  51          
  52          void Timer1Init(void)           //1毫秒@11.0592MHz
  53          {
  54   1              TMOD &= 0x0F;           //设置定时器模式
C51 COMPILER V9.60.0.0   MAIN                                                              02/14/2023 00:09:59 PAGE 2   

  55   1              TMOD |= 0x10;           //设置定时器模式
  56   1              TL1 = 0x66;             //设置定时初始值
  57   1              TH1 = 0xFC;             //设置定时初始值
  58   1              TF1 = 0;                //清除TF1标志
  59   1              ET1 = 1;
  60   1              TR1 = 1;                //定时器1开始计时
  61   1      }
  62          
  63          void EX0_Init(void)
  64          {
  65   1              IT0 = 1;
  66   1              EX0 = 1;
  67   1      }
  68          
  69          void EX1_Init(void)
  70          {
  71   1              IT1 = 1;
  72   1              EX1 = 1;
  73   1      }
  74          void ShowNormal()
  75          {
  76   1              LEDBUF[7] = Hou/10;
  77   1              LEDBUF[6] = Hou%10;
  78   1              LEDBUF[5] = 22;
  79   1              LEDBUF[4] = Min/10;
  80   1              LEDBUF[3] = Min%10;
  81   1              LEDBUF[2] = 22;
  82   1              LEDBUF[1] = Sec/10;
  83   1              LEDBUF[0] = Sec%10;
  84   1      }
  85          
  86          void ShowSec()
  87          {
  88   1              LEDBUF[7] = 23;
  89   1              LEDBUF[6] = 23;
  90   1              LEDBUF[5] = 22;
  91   1              LEDBUF[4] = 23;
  92   1              LEDBUF[3] = 23;
  93   1              LEDBUF[2] = 22;
  94   1              LEDBUF[1] = Sec/10;
  95   1              LEDBUF[0] = Sec%10;
  96   1      }
  97          
  98          void ShowMin()
  99          {
 100   1              LEDBUF[7] = 23;
 101   1              LEDBUF[6] = 23;
 102   1              LEDBUF[5] = 22;
 103   1              LEDBUF[4] = Min/10;
 104   1              LEDBUF[3] = Min%10;
 105   1              LEDBUF[2] = 22;
 106   1              LEDBUF[1] = 23;
 107   1              LEDBUF[0] = 23;
 108   1      }
 109          void ShowHou()
 110          {
 111   1              LEDBUF[7] = Hou/10;
 112   1              LEDBUF[6] = Hou%10;
 113   1              LEDBUF[5] = 22;
 114   1              LEDBUF[4] = 23;
 115   1              LEDBUF[3] = 23;
 116   1              LEDBUF[2] = 22;
C51 COMPILER V9.60.0.0   MAIN                                                              02/14/2023 00:09:59 PAGE 3   

 117   1              LEDBUF[1] = 23;
 118   1              LEDBUF[0] = 23;
 119   1      }
 120          void timer0_ISR(void) interrupt 1
 121          {
 122   1              TR0 = 0;
 123   1              TimerCnt++;
 124   1              if(TimerCnt >= 20)
 125   1              {
 126   2                      TimerCnt = 0;
 127   2                      Sec++;
 128   2                      if(Sec >= 60)
 129   2                      {
 130   3                              Sec = 0;
 131   3                              Min++;
 132   3                              if(Min >= 60)
 133   3                              {
 134   4                                      Min = 0;
 135   4                                      Hou++;
 136   4                                      if(Hou >= 24)
 137   4                                              Hou =0;
 138   4                              }
 139   3                      }
 140   2              }
 141   1              TL0 = 0x00;             //设置定时初始值
 142   1              TH0 = 0x4C;             //设置定时初始值
 143   1              TR0 = 1;
 144   1      
 145   1      }
 146          void timer1_ISR(void) interrupt 3
 147          {
 148   1              TR1 = 0;
 149   1              TL1 = 0x66;             //设置定时初始值
 150   1              TH1 = 0xFC;             //设置定时初始值
 151   1              display(); 
 152   1              TR1 = 1;
 153   1      }
 154          
 155          void EX0_ISR() interrupt 0
 156          {
 157   1              
 158   1              TR0 = 0;
 159   1              state++;
 160   1              if(state > 3)
 161   1              {
 162   2                      state = 0;
 163   2                      TR0 = 1;
 164   2              }
 165   1      
 166   1      }
 167          
 168          void EX1_ISR(void) interrupt 2
 169          {
 170   1              switch(state)
 171   1              {
 172   2                      case 1:
 173   2                              Sec++;
 174   2                              if(Sec >= 60)
 175   2                                      Sec = 0;
 176   2                              break;
 177   2                      case 2:
 178   2                              Min++;
C51 COMPILER V9.60.0.0   MAIN                                                              02/14/2023 00:09:59 PAGE 4   

 179   2                              if(Min >= 60)
 180   2                                      Min = 0;
 181   2                              break;
 182   2                      case 3:
 183   2                              Hou++;
 184   2                              if(Hou >= 60)
 185   2                                      Hou = 0;
 186   2                              break;  
 187   2                      default:break;
 188   2              }
 189   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    515    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
